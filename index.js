import require$$0$1 from"fs";import require$$0 from"path";import require$$2$1 from"child_process";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(r){var o,e=r.default;return"function"==typeof e?(o=function(){return e.apply(this,arguments)}).prototype=e.prototype:o={},Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(r).forEach(function(e){var t=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(o,e,t.get?t:{enumerable:!0,get:function(){return r[e]}})}),o}var es={},sync={};function hasKey(e,t){var r=e;return t.slice(0,-1).forEach(function(e){r=r[e]||{}}),t[t.length-1]in r}function isNumber(e){return"number"==typeof e||(!!/^0x[0-9a-f]+$/i.test(e)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e))}function isConstructorOrProto(e,t){return"constructor"===t&&"function"==typeof e[t]||"__proto__"===t}module.exports=function(e,t){var s={bools:{},strings:{},unknownFn:null},l=("function"==typeof(t=t||{}).unknown&&(s.unknownFn=t.unknown),"boolean"==typeof t.boolean&&t.boolean?s.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach(function(e){s.bools[e]=!0}),{}),r=(Object.keys(t.alias||{}).forEach(function(e){l[e]=[].concat(t.alias[e]),l[e].forEach(function(t){l[t]=[e].concat(l[e].filter(function(e){return t!==e}))})}),[].concat(t.string).filter(Boolean).forEach(function(e){s.strings[e]=!0,l[e]&&(s.strings[l[e]]=!0)}),t.default||{}),a={_:[]},o=(Object.keys(s.bools).forEach(function(e){n(e,void 0!==r[e]&&r[e])}),[]);function n(e,t,r){var o,n,i;r&&s.unknownFn&&(o=e,n=r,!(s.allBools&&/^--[^=]+$/.test(n)||s.strings[o]||s.bools[o]||l[o]))&&!1===s.unknownFn(r)||(i=!s.strings[e]&&isNumber(t)?Number(t):t,c(a,e.split("."),i),(l[e]||[]).forEach(function(e){c(a,e.split("."),i)}))}function c(e,t,r){for(var o,n=e,i=0;i<t.length-1;i++){if(isConstructorOrProto(n,o=t[i]))return;void 0===n[o]&&(n[o]={}),n[o]!==Object.prototype&&n[o]!==Number.prototype&&n[o]!==String.prototype||(n[o]={}),n[o]===Array.prototype&&(n[o]=[]),n=n[o]}isConstructorOrProto(n,o=t[t.length-1])||(void 0===(n=(n=n!==Object.prototype&&n!==Number.prototype&&n!==String.prototype?n:{})===Array.prototype?[]:n)[o]||s.bools[o]||"boolean"==typeof n[o]?n[o]=r:Array.isArray(n[o])?n[o].push(r):n[o]=[n[o],r])}function i(e){return l[e].some(function(e){return s.bools[e]})}-1!==e.indexOf("--")&&(o=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(var p=0;p<e.length;p++){var u=e[p];if(/^--.+=/.test(u)){var g=u.match(/^--([^=]+)=([\s\S]*)$/),f=g[1],g=g[2];n(f,g=s.bools[f]?"false"!==g:g,u)}else if(/^--no-.+/.test(u))n(f=u.match(/^--no-(.+)/)[1],!1,u);else if(/^--.+/.test(u)){f=u.match(/^--(.+)/)[1];void 0===(d=e[p+1])||/^-/.test(d)||s.bools[f]||s.allBools||l[f]&&i(f)?/^(true|false)$/.test(d)?(n(f,"true"===d,u),p++):n(f,!s.strings[f]||"",u):(n(f,d,u),p++)}else if(/^-[^-]+/.test(u)){for(var d,m=u.slice(1,-1).split(""),y=!1,h=0;h<m.length;h++)if("-"===(d=u.slice(h+2)))n(m[h],d,u);else{if(/[A-Za-z]/.test(m[h])&&/=/.test(d)){n(m[h],d.split("=")[1],u),y=!0;break}if(/[A-Za-z]/.test(m[h])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(d)){n(m[h],d,u),y=!0;break}if(m[h+1]&&m[h+1].match(/\W/)){n(m[h],u.slice(h+2),u),y=!0;break}n(m[h],!s.strings[m[h]]||"",u)}f=u.slice(-1)[0];y||"-"===f||(!e[p+1]||/^(-|--)[^-]/.test(e[p+1])||s.bools[f]||l[f]&&i(f)?e[p+1]&&/^(true|false)$/.test(e[p+1])?(n(f,"true"===e[p+1],u),p++):n(f,!s.strings[f]||"",u):(n(f,e[p+1],u),p++))}else if(s.unknownFn&&!1===s.unknownFn(u)||a._.push(s.strings._||!isNumber(u)?u:Number(u)),t.stopEarly){a._.push.apply(a._,e.slice(p+1));break}}return Object.keys(r).forEach(function(t){hasKey(a,t.split("."))||(c(a,t.split("."),r[t]),(l[t]||[]).forEach(function(e){c(a,e.split("."),r[t])}))}),t["--"]?(a["--"]=new Array,o.forEach(function(e){a["--"].push(e)})):o.forEach(function(e){a._.push(e)}),a};var minimist$1=Object.freeze({__proto__:null}),require$$2=getAugmentedNamespace(minimist$1),utils={};const ansiStyles=require("ansi-styles"),{stdout:stdoutColor,stderr:stderrColor}=require("supports-color"),{stringReplaceAll,stringEncaseCRLFWithFirstIndex}=require("./util"),isArray=Array["isArray"],levelMapping=["ansi","ansi","ansi256","ansi16m"],styles=Object.create(null),applyOptions=(e,t={})=>{if(t.level&&!(Number.isInteger(t.level)&&0<=t.level&&t.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");var r=stdoutColor?stdoutColor.level:0;e.level=void 0===t.level?r:t.level};class ChalkClass{constructor(e){return chalkFactory(e)}}const chalkFactory=e=>{const t={};return applyOptions(t,e),t.template=(...e)=>chalkTag(t.template,...e),Object.setPrototypeOf(t,Chalk.prototype),Object.setPrototypeOf(t.template,t),t.template.constructor=()=>{throw new Error("`chalk.constructor()` is deprecated. Use `new chalk.Instance()` instead.")},t.template.Instance=ChalkClass,t.template};function Chalk(e){return chalkFactory(e)}for(const[na,oa]of Object.entries(ansiStyles))styles[na]={get(){var e=createBuilder(this,createStyler(oa.open,oa.close,this._styler),this._isEmpty);return Object.defineProperty(this,na,{value:e}),e}};styles.visible={get(){var e=createBuilder(this,this._styler,!0);return Object.defineProperty(this,"visible",{value:e}),e}};const usedModels=["rgb","hex","keyword","hsl","hsv","hwb","ansi","ansi256"];for(const ra of usedModels)styles[ra]={get(){const t=this["level"];return function(...e){e=createStyler(ansiStyles.color[levelMapping[t]][ra](...e),ansiStyles.color.close,this._styler);return createBuilder(this,e,this._isEmpty)}}};for(const va of usedModels){const wa="bg"+va[0].toUpperCase()+va.slice(1);styles[wa]={get(){const t=this["level"];return function(...e){e=createStyler(ansiStyles.bgColor[levelMapping[t]][va](...e),ansiStyles.bgColor.close,this._styler);return createBuilder(this,e,this._isEmpty)}}}}const proto=Object.defineProperties(()=>{},{...styles,level:{enumerable:!0,get(){return this._generator.level},set(e){this._generator.level=e}}}),createStyler=(e,t,r)=>{let o,n;return n=void 0===r?(o=e,t):(o=r.openAll+e,t+r.closeAll),{open:e,close:t,openAll:o,closeAll:n,parent:r}},createBuilder=(e,t,r)=>{const o=(...e)=>isArray(e[0])&&isArray(e[0].raw)?applyStyle(o,chalkTag(o,...e)):applyStyle(o,1===e.length?""+e[0]:e.join(" "));return Object.setPrototypeOf(o,proto),o._generator=e,o._styler=t,o._isEmpty=r,o},applyStyle=(e,t)=>{if(e.level<=0||!t)return e._isEmpty?"":t;let r=e._styler;if(void 0===r)return t;var{openAll:e,closeAll:o}=r;if(-1!==t.indexOf(""))for(;void 0!==r;)t=stringReplaceAll(t,r.close,r.open),r=r.parent;var n=t.indexOf("\n");return e+(t=-1!==n?stringEncaseCRLFWithFirstIndex(t,o,e,n):t)+o};let template;const chalkTag=(e,...t)=>{var[r]=t;if(!isArray(r)||!isArray(r.raw))return t.join(" ");var o=t.slice(1),n=[r.raw[0]];for(let e=1;e<r.length;e++)n.push(String(o[e-1]).replace(/[{}\\]/g,"\\$&"),String(r.raw[e]));return(template=void 0===template?require("./templates"):template)(e,n.join(""))},chalk=(Object.defineProperties(Chalk.prototype,styles),Chalk());chalk.supportsColor=stdoutColor,chalk.stderr=Chalk({level:stderrColor?stderrColor.level:0}),chalk.stderr.supportsColor=stderrColor,module.exports=chalk;var source=Object.freeze({__proto__:null}),require$$1=getAugmentedNamespace(source),lib=(!function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.globalInject=o.gitPush=o.command=o.override=o.configCreate=o.descResolver=o.resolver=o.FileType=o.Action=void 0;const n=require$$0,i=require$$1;var s,e;(e=s=o.Action||(o.Action={})).COPY="COPY",e.REMOVE="REMOVE",e.CREATE="CREATE",(e=o.FileType||(o.FileType={})).FILE="FILE",e.FOLDER="FOLDER",o.resolver=(t,r,o)=>e=>e.map(([e])=>({action:t?s.COPY:s.REMOVE,origin:t?n.resolve(t):null,target:r?n.join(e,r):n.join(e,t),changedCheckAndBackup:o})),o.descResolver=(t,r)=>e=>e.map(([e])=>({action:s.CREATE,origin:r,target:n.join(e,t),changedCheckAndBackup:!1})),o.configCreate=e=>{let t=[];for(const r of e.mapping)t=[...t,...r(e.workspaces)];for(const o of e.description)t=[...t,...o(e.workspaces)];return{workspaces:e.workspaces,mapping:t}},o.override=async()=>{globalThis.__console=globalThis.console,globalThis.console=new Proxy({},{get(e,t,r){return"log"===t?(...e)=>{globalThis.__console.log(...e.map((e,t)=>0===t?i.underline(i.bgGreen(i.white(` [${String(e)}] `))):i.green("[")+String(e)+i.green("]")))}:"error"===t?(...e)=>{globalThis.__console.log(...e.map((e,t)=>0===t?i.underline(i.bgRed(i.white(` [${String(e)}] `))):i.red(String(e))))}:void Reflect.get(e,t,r)}})},o.command=({cmd:t=[],onOut:n=e=>e,onErr:i=e=>e})=>{const s=require$$2$1.spawn;return new Promise((r,o)=>{0===t.length&&o(Error("æ²¡è¾“å…¥å‘½ä»¤"));var e=t.slice(1),e=s(t[0],e);e.stdout.on("data",function(e){n(e)}),e.stderr.on("data",function(e){i(e)}),e.on("exit",function(e,t){(0===e?r:o)(e)})})},o.gitPush=async(e,t=e=>e,r)=>{await(0,o.command)({cmd:["sh",n.join(__dirname,"gitpush.sh"),e,r?.origin||"master",r?.comments||"Common Module Sync"],onOut(e){t(e)},onErr(e){t(e)}})};o.globalInject=()=>{globalThis.resolver=o.resolver,globalThis.descResolver=o.descResolver,globalThis.configCreate=o.configCreate}}(utils),module.exports={...require("./fs"),...require("./copy"),...require("./empty"),...require("./ensure"),...require("./json"),...require("./mkdirs"),...require("./move"),...require("./output-file"),...require("./path-exists"),...require("./remove")},Object.freeze({__proto__:null})),require$$4=getAugmentedNamespace(lib);Object.defineProperty(sync,"__esModule",{value:!0}),sync.run=void 0;const fs=require$$0$1,path=require$$0,minimist=require$$2,utils_1=utils,fsExtra=require$$4,run=async()=>{(0,utils_1.globalInject)(),await(0,utils_1.override)();var t,r,e=minimist(process.argv.slice(2));let n=null;if(!(n=e.c?require(path.resolve(e.c)):require(path.resolve(".syncrc.js"))))throw e="The config file not exist.",console.log("Error",e),Error(e);for(let e in n.mapping)n.mapping[e].action===utils_1.Action.CREATE?(console.log(n.mapping[e].action,n.mapping[e].origin,n.mapping[e].target+".desc"),await new Promise((t,r)=>fs.writeFile(n.mapping[e].target+".desc",n.mapping[e].origin,e=>{e?r(e):t(null)}))):n.mapping[e].action===utils_1.Action.COPY?(console.log(n.mapping[e].action+" - Compare:"+n.mapping[e].changedCheckAndBackup,n.mapping[e].origin,n.mapping[e].target),t=await new Promise((r,o)=>{fs.stat(n.mapping[e].origin,(e,t)=>{e?(console.error("ERROR",e),r(null)):t.isFile()?r(utils_1.FileType.FILE):t.isDirectory()?r(utils_1.FileType.FOLDER):o("not file and not folder")})}),r=await new Promise((r,o)=>{fs.stat(n.mapping[e].target,(e,t)=>{e?(console.error("ERROR",e),r(null)):t.isFile()?r(utils_1.FileType.FILE):t.isDirectory()?r(utils_1.FileType.FOLDER):o("not file and not folder")})}),t===utils_1.FileType.FILE&&r===utils_1.FileType.FILE&&n.mapping[e].changedCheckAndBackup&&(t=await new Promise((r,o)=>fs.readFile(n.mapping[e].origin,(e,t)=>{e?o(e):r(t)})),r=await new Promise((r,o)=>fs.readFile(n.mapping[e].target,(e,t)=>{e?o(e):r(t)})),String(t).trim()==String(r).trim()?(console.log("Same",!0),console.log("Backup",!1)):(console.log("Same",!1),await new Promise((t,r)=>fs.rename(n.mapping[e].target,n.mapping[e].target+".backup",e=>{e?r(e):t(null)})),console.log("Backup",n.mapping[e].target+".backup"))),await fsExtra.copy(n.mapping[e].origin,n.mapping[e].target)):n.mapping[e].action===utils_1.Action.REMOVE&&(console.log(n.mapping[e].action,n.mapping[e].origin,n.mapping[e].target),await fsExtra.remove(n.mapping[e].target));for(const s in n.workspaces){var[o,i]=n.workspaces[s];i&&await(0,utils_1.gitPush)(o,e=>{console.log("GitPush",e)})}};sync.run=run,function(e){var o=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){e[o=void 0===o?r:o]=t[r]}),t=commonjsGlobal&&commonjsGlobal.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(e,"__esModule",{value:!0}),t(sync,e),t(utils,e)}(es);var index=getDefaultExportFromCjs(es);export{index as default};
